<!DOCTYPE html>
<html><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GUIプログラミングの手引</title>
    <link rel="stylesheet" href="https://user040404.github.io/normalize.css" />
    <link rel="stylesheet" href="https://user040404.github.io/style.css" />
    <link rel="icon" href="/favicon.svg" />
</head>
<body><header>
<script type="text/javascript" src="//xa.shinobi.jp/ufo/190668700"></script><noscript><a href="//xa.shinobi.jp/bin/gg?190668700" target="_blank"><img src="//xa.shinobi.jp/bin/ll?190668700" border="0"></a><br><span style="font-size:9px"><img style="margin:0;vertical-align:text-bottom;" src="//img.shinobi.jp/tadaima/fj.gif" width="19" height="11"> </span></noscript>
<div id="date"><time datetime="2025-10-28 01:35:16">2025-10-28 01:35:16</time></div>
<div><a href="https://user040404.github.io/">トップページ</a></div>
<h1>GUIプログラミングの手引</h1>
<nav id="TableOfContents">
  <ul>
    <li><a href="#はじめに">はじめに</a></li>
    <li><a href="#プログラミングの予備知識">プログラミングの予備知識</a>
      <ul>
        <li><a href="#ポインタ">ポインタ</a></li>
        <li><a href="#クラスおよびオブジェクト">クラスおよびオブジェクト</a></li>
      </ul>
    </li>
    <li><a href="#アプリケーションの開発環境">アプリケーションの開発環境</a></li>
    <li><a href="#プログラミングの作業工程">プログラミングの作業工程</a>
      <ul>
        <li><a href="#hello-world">Hello World</a></li>
        <li><a href="#メッセージボックスの表示">メッセージボックスの表示</a></li>
        <li><a href="#メインウィンドウの表示その1">メインウィンドウの表示(その1)</a></li>
        <li><a href="#メインウィンドウの表示その2">メインウィンドウの表示(その2)</a></li>
        <li><a href="#ソースファイルの分割">ソースファイルの分割</a></li>
        <li><a href="#ビルド作業の自動化">ビルド作業の自動化</a></li>
        <li><a href="#メインウィンドウの表示その3">メインウィンドウの表示(その3)</a></li>
      </ul>
    </li>
    <li><a href="#プログラミングの学習方法">プログラミングの学習方法</a></li>
  </ul>
</nav>
</header>
<div id="content">
<h2 id="はじめに">はじめに</h2>
<p>MSYS2という開発環境を使用してWindowsアプリケーションを作成する方法を紹介します。MSYS2については<a href="/unix.html">Unixの基本操作</a>を参照してください。</p>
<h2 id="プログラミングの予備知識">プログラミングの予備知識</h2>
<p>以下に掲載するコードは<a href="https://ja.wikipedia.org/wiki/C%E8%A8%80%E8%AA%9E">C言語</a>および<a href="https://ja.wikipedia.org/wiki/C%2B%2B">C++</a>というプログラミング言語で記述されています。C言語で記述されたコードの中ではWindowsの機能にアクセスするために<a href="https://ja.wikipedia.org/wiki/Windows_API">WindowsAPI</a>を使用しています。<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>WindowsAPIを使用するためのツールがWindowsSDKです。C言語とWindowsSDKの組み合わせを「CとSDK」といったりします。</p>
<p>C++はC言語を拡張してオブジェクト指向でプログラミングできるようにした言語です。C++はC言語との互換性を持たせて拡張したので、他の純粋なオブジェクト指向の言語と比べて仕様が複雑になっていますが、C言語にはない便利な機能がたくさん追加されています。詳細については<a href="https://rinatz.github.io/cpp-book/">ゼロから学ぶC++</a>や<a href="https://programming-place.net/ppp/index.html">ProgrammingPlacePlus</a>を参照してください。</p>
<p>アプリケーションを作成するにはプログラムのソースコードを編集するためのテキストエディタをはじめ、ソースファイルからオブジェクトファイルを生成するためのコンパイラや、オブジェクトファイルとライブラリをリンクするためのリンカなどが必要です。アプリケーションを作成するためのこれらのプログラムを総称して<a href="https://ja.wikipedia.org/wiki/%E3%83%84%E3%83%BC%E3%83%AB%E3%83%81%E3%82%A7%E3%83%BC%E3%83%B3">ツールチェーン</a>といいます。</p>
<p><a href="https://ja.wikipedia.org/wiki/%E3%82%B0%E3%83%A9%E3%83%95%E3%82%A3%E3%82%AB%E3%83%AB%E3%83%A6%E3%83%BC%E3%82%B6%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9">GUI</a>のアプリケーションを作成するには<a href="https://ja.wikipedia.org/wiki/%E3%82%A6%E3%82%A3%E3%82%B8%E3%82%A7%E3%83%83%E3%83%88%E3%83%BB%E3%83%84%E3%83%BC%E3%83%AB%E3%82%AD%E3%83%83%E3%83%88">GUIツールキット</a>と<a href="https://ja.wikipedia.org/wiki/GUI%E3%83%93%E3%83%AB%E3%83%80">GUIビルダ</a>を使用します。WindowsAPIはWindowsに内蔵されている低レベルなツールキットです。<a href="https://ja.wikipedia.org/wiki/Windows_Template_Library">WTL</a>や<a href="https://ja.wikipedia.org/wiki/WxWidgets">wxWidgets</a>などの高レベルなツールキットを使用することもできます。詳細については<a href="http://wisdom.sakura.ne.jp/">WisdomSoft</a>や<a href="https://vivacocoa.jp/">vivaCocoa</a>を参照してください。</p>
<h3 id="ポインタ">ポインタ</h3>
<p>C言語のポインタについてかみ砕いて説明します。変数のデータはコンピュータのメモリのどこかに置かれています。その置かれている場所をアドレスといいます。アドレスは変数の住所のようなものだと考えてください。変数は変数名だけでなくアドレスによっても表現できます。ポインタは変数のアドレスを格納するための変数です。ポインタと聞くと何か特別なもののように感じますがただの変数に過ぎません。ポインタ変数もしくはアドレス型の変数といったほうが分かりやすいかもしれません。</p>
<p>ポインタの値すなわち変数のアドレスを変更するためにポインタのポインタが使用されることがあります。ポインタのポインタと聞くと頭が混乱するかもしれませんが難しいことではありません。以下のコードを見てよく考えてください。</p>


<figure class="xCodeBlock">

<div class="xCodeBlock_code"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">void</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>ptr;      <span style="color:#75715e">// ポインタ
</span></span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">char</span> <span style="color:#f92672">**</span>ptrptr;  <span style="color:#75715e">// ポインタのポインタ
</span></span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">char</span> str1[<span style="color:#ae81ff">256</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;foo&#34;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">char</span> str2[<span style="color:#ae81ff">256</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bar&#34;</span>;
</span></span><span style="display:flex;"><span>  ptr <span style="color:#f92672">=</span> str1;           <span style="color:#75715e">// ptrにstr1のアドレスを代入
</span></span></span><span style="display:flex;"><span>  printf(<span style="color:#e6db74">&#34;%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, ptr);  <span style="color:#75715e">// fooと表示
</span></span></span><span style="display:flex;"><span>  ptrptr <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>ptr;        <span style="color:#75715e">// ptrのアドレスをptrptrに代入
</span></span></span><span style="display:flex;"><span>  <span style="color:#f92672">*</span>ptrptr <span style="color:#f92672">=</span> str2;  <span style="color:#75715e">// ptrptrを参照してptrにstr2のアドレスを代入
</span></span></span><span style="display:flex;"><span>  printf(<span style="color:#e6db74">&#34;%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, ptr);  <span style="color:#75715e">// barと表示
</span></span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> EXIT_SUCCESS;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div></div>
</figure>
<p>ポインタにconstを適用する場合、ポインタの示すアドレスを定数にするのかそれともそのアドレスに置かれているデータを定数にするのかという問題が生じます。これは次のように書き分けます。</p>


<figure class="xCodeBlock">

<div class="xCodeBlock_code"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">int</span><span style="color:#f92672">*</span> <span style="color:#66d9ef">const</span> p; <span style="color:#75715e">// アドレスが定数
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">*</span> p; <span style="color:#75715e">// データが定数
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#66d9ef">const</span><span style="color:#f92672">*</span> p; <span style="color:#75715e">// データが定数
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">*</span> <span style="color:#66d9ef">const</span> p; <span style="color:#75715e">// アドレス・データともに定数
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#66d9ef">const</span><span style="color:#f92672">*</span> <span style="color:#66d9ef">const</span> p; <span style="color:#75715e">// アドレス・データともに定数
</span></span></span></code></pre></div></div>
</figure>
<h3 id="クラスおよびオブジェクト">クラスおよびオブジェクト</h3>
<p>C++のクラスについて簡単に説明します。C言語の構造体はそのメンバとして型の異なる複数の変数を持つことができます。クラスはメンバとして関数を持てるように構造体を拡張したものです。クラスのメンバ変数を「プロパティ」、クラスのメンバ関数を「メソッド」、クラス型の変数を「オブジェクト」、クラスを変数として実体化することを「インスタンス化」といいます。</p>
<p>オブジェクトはデータに機能を持たせたものと捉えることができます。オブジェクトのプロパティはメソッドを介して参照・操作します。プロパティを直接参照したり操作したりすることは一般的ではありません。このようにインターフェイスのみを公開して実装を非公開にすることを「カプセル化」といいます。カプセル化することによってプログラムの保守性・拡張性・移植性を高めることができます。</p>
<p>C++のクラスのメンバには[private/public/protected]という3つの属性があります。privateメンバは自クラスからしか参照することができず外部からは参照できません。publicメンバは自クラスだけでなく外部からも自由に参照できます。protectedメンバはprivateメンバと同様に外部からは参照できませんが自クラスだけでなく派生クラスからも参照できます。派生クラス(サブクラス)とは文字通りあるクラスから派生したクラスです。派生元のクラスを基底クラス(ベースクラス)といい派生クラスは基底クラスのメンバをすべて継承します。</p>
<p>C++では引数の型や引数の数が異なる同名の関数を複数定義(オーバーロード)できます。基底クラスのメソッドにvirtualというキーワードをつけるとそのメソッドを派生クラスで再定義(オーバーライド)することもできます。オーバーロード(関数の多重定義)とオーバーライド(メソッドの再定義)を混同しないように注意してください。</p>
<p>C++には<a href="https://ja.wikipedia.org/wiki/Standard_Template_Library">STL</a>という標準ライブラリが用意されています。このライブラリには、よく使用するデータ構造やアルゴリズムがクラスとして定義されていて、ライブラリのヘッダファイルをインクルードするだけで、これらの便利なクラスをすぐに使用できます。STLのstringクラスによって、C言語では扱いが面倒だった文字列が手軽に扱えるようになりました。C言語で可変長の配列を実現しようとすれば大変な作業になりますが、STLには可変長の配列を扱うvectorクラスがあります。</p>
<p>STLのクラスや関数にはC++のテンプレートという機能が使用されています。テンプレートによってクラスや関数はいろいろな型のデータを受け取ることができます。テンプレートやオーバーロード・オーバーライドの仕組みによってC++では汎用性のあるプログラムを書くことができます。オブジェクト指向の分野ではこれを多態性(ポリモーフィズム)といいます。</p>
<h2 id="アプリケーションの開発環境">アプリケーションの開発環境</h2>
<p>実際にアプリケーションを作成する前にアプリケーションの開発環境を構築する必要があります。ここでは開発環境としてMSYS2を使用します。MSYS2にツールチェーンとして<a href="https://ja.wikipedia.org/wiki/MinGW">MinGW</a>をインストールします。</p>


<figure class="xCodeBlock">

<div class="xCodeBlock_code"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-text" data-lang="text"><span style="display:flex;"><span># pacman -S mingw-w64-i686-toolchain
</span></span><span style="display:flex;"><span># pacman -S mingw-w64-x86_64-toolchain</span></span></code></pre></div></div>
</figure>
<p>mingw-w64-*-toolchainはMinGWのパッケージグループです。32bit(i686)および64bit(x86_64)の環境で動作するアプリケーションを作成するためのツールチェーンを個別にインストールします。MinGWを使用するにはスタートメニューから[MSYS2 MinGW 32-bit]もしくは[MSYS2 MinGW 64-bit]のいずれかを選択します。<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup></p>
<p>MinGWにはテキストエディタが含まれていないので別途用意します。文字コードとしてUnicodeが扱えるものであればWindows用のテキストエディタでも構いません。プログラムのコーディングに特化したテキストエディタはコードエディタと呼ばれています。開発者の多くがコードエディタとして<a href="https://code.visualstudio.com/">VS Code</a>を使用しています。</p>
<!--
リソースエディタには[ResEdit](http://www.resedit.net/)などを使用します。
MSYS2には[Geany](https://ja.wikipedia.org/wiki/Geany)/[gedit](https://ja.wikipedia.org/wiki/Gedit)/[Kate](https://ja.wikipedia.org/wiki/Kate)/[Vim](https://ja.wikipedia.org/wiki/Vim)などのテキストエディタが用意されています。
-->
<h2 id="プログラミングの作業工程">プログラミングの作業工程</h2>
<h3 id="hello-world">Hello World</h3>
<p>細かい理屈は後回しにして実際に簡単なプログラムを作って動かしてみましょう。文字化けを防ぐためテキストエディタでソースコードを保存する際は文字コードとしてUTF-8を指定してください。</p>
<p>以下のコードを記述したソースファイルhello.cを作成します。</p>


<figure class="xCodeBlock">
<figcaption class="xCodeBlock_title">hello.c</figcaption>
<div class="xCodeBlock_code"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">void</span>) {
</span></span><span style="display:flex;"><span>  printf(<span style="color:#e6db74">&#34;Hello, World!</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> EXIT_SUCCESS;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div></div>
</figure>
<p>コマンドgccを入力してhello.cをコンパイルし出力されたa.exeを実行します。</p>


<figure class="xCodeBlock">

<div class="xCodeBlock_code"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-text" data-lang="text"><span style="display:flex;"><span># gcc hello.c
</span></span><span style="display:flex;"><span># ./a.exe</span></span></code></pre></div></div>
</figure>
<p>&ldquo;Hello, World!&ldquo;と表示されたら成功です。</p>
<h3 id="メッセージボックスの表示">メッセージボックスの表示</h3>
<p>メッセージボックスを表示してみます。以下のコードを記述したソースファイルmessage.cを作成します。</p>


<figure class="xCodeBlock">
<figcaption class="xCodeBlock_title">message.c</figcaption>
<div class="xCodeBlock_code"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;windows.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> WINAPI <span style="color:#a6e22e">WinMain</span>(HINSTANCE hInst, HINSTANCE hPrevInst, LPSTR pCmdLine,
</span></span><span style="display:flex;"><span>                   <span style="color:#66d9ef">int</span> showCmd) {
</span></span><span style="display:flex;"><span>  MessageBox(NULL, <span style="color:#e6db74">&#34;こんにちは&#34;</span>, <span style="color:#e6db74">&#34;メッセージ&#34;</span>, MB_OK);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> EXIT_SUCCESS;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div></div>
</figure>
<p>コマンドgccを入力してmessage.cをコンパイルします。今回はオプション-oで出力する実行ファイルを指定しています。-fexec-charset=CP932は文字化けを防ぐためのオプションです。WindowsアプリケーションではテキストデータをUnicode(UTF-8)ではなくShift-JIS(CP932)として処理しています。</p>


<figure class="xCodeBlock">

<div class="xCodeBlock_code"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-text" data-lang="text"><span style="display:flex;"><span># gcc message.c -o message.exe -fexec-charset=CP932
</span></span><span style="display:flex;"><span># ./message.exe</span></span></code></pre></div></div>
</figure>
<p>メッセージボックスが表示されたら成功です。</p>
<h3 id="メインウィンドウの表示その1">メインウィンドウの表示(その1)</h3>
<p>ウィンドウを表示してみます。以下のコードを記述したソースファイルwindow.cを作成します。</p>


<figure class="xCodeBlock">
<figcaption class="xCodeBlock_title">window.c</figcaption>
<div class="xCodeBlock_code"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;windows.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 記号定数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define WINDOW_CLASS &#34;foo&#34;                 </span><span style="color:#75715e">// ウィンドウクラス名
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define WINDOW_TITLE &#34;サンプルウィンドウ&#34;  </span><span style="color:#75715e">// タイトルバーの文字列
</span></span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// プロトタイプ宣言
</span></span></span><span style="display:flex;"><span>LRESULT CALLBACK <span style="color:#a6e22e">WindowProc</span>(HWND hWnd, UINT msg, WPARAM wp, LPARAM lp);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// エントリポイント
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> WINAPI <span style="color:#a6e22e">WinMain</span>(HINSTANCE hInst, HINSTANCE hPrevInst, LPSTR lpCmdLine,
</span></span><span style="display:flex;"><span>                   <span style="color:#66d9ef">int</span> iCmdShow) {
</span></span><span style="display:flex;"><span>  WNDCLASSEX wc;  <span style="color:#75715e">// ウィンドウクラス構造体
</span></span></span><span style="display:flex;"><span>  HWND hWnd;      <span style="color:#75715e">// ウィンドウハンドル
</span></span></span><span style="display:flex;"><span>  MSG msg;        <span style="color:#75715e">// メッセージ構造体
</span></span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// ウィンドウクラスを設定
</span></span></span><span style="display:flex;"><span>  wc.cbSize <span style="color:#f92672">=</span> <span style="color:#66d9ef">sizeof</span>(wc);              <span style="color:#75715e">// 構造体のサイズ
</span></span></span><span style="display:flex;"><span>  wc.style <span style="color:#f92672">=</span> CS_HREDRAW <span style="color:#f92672">|</span> CS_VREDRAW;  <span style="color:#75715e">// スタイル
</span></span></span><span style="display:flex;"><span>  wc.lpfnWndProc <span style="color:#f92672">=</span> WindowProc;         <span style="color:#75715e">// ウィンドウプロシージャ
</span></span></span><span style="display:flex;"><span>  wc.cbClsExtra <span style="color:#f92672">=</span> wc.cbWndExtra <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;   <span style="color:#75715e">// 拡張領域のサイズ
</span></span></span><span style="display:flex;"><span>  wc.hInstance <span style="color:#f92672">=</span> hInst;                <span style="color:#75715e">// インスタンスハンドル
</span></span></span><span style="display:flex;"><span>  wc.hIcon <span style="color:#f92672">=</span> LoadIcon(NULL, IDI_APPLICATION);  <span style="color:#75715e">// アイコン
</span></span></span><span style="display:flex;"><span>  wc.hIconSm <span style="color:#f92672">=</span> wc.hIcon;                       <span style="color:#75715e">// アイコン(小)
</span></span></span><span style="display:flex;"><span>  wc.hCursor <span style="color:#f92672">=</span> LoadCursor(NULL, IDC_ARROW);    <span style="color:#75715e">// カーソル
</span></span></span><span style="display:flex;"><span>  wc.hbrBackground <span style="color:#f92672">=</span> (HBRUSH)(COLOR_WINDOW);   <span style="color:#75715e">// 背景色
</span></span></span><span style="display:flex;"><span>  wc.lpszMenuName <span style="color:#f92672">=</span> NULL;                      <span style="color:#75715e">// メニュー名
</span></span></span><span style="display:flex;"><span>  wc.lpszClassName <span style="color:#f92672">=</span> WINDOW_CLASS;             <span style="color:#75715e">// ウィンドウクラス名
</span></span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// ウィンドウクラスを登録
</span></span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (RegisterClassEx(<span style="color:#f92672">&amp;</span>wc) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> EXIT_FAILURE;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// ウィンドウを作成
</span></span></span><span style="display:flex;"><span>  hWnd <span style="color:#f92672">=</span> CreateWindow(WINDOW_CLASS,         <span style="color:#75715e">// ウィンドウクラス名
</span></span></span><span style="display:flex;"><span>                      WINDOW_TITLE,         <span style="color:#75715e">// タイトルバーの文字列
</span></span></span><span style="display:flex;"><span>                      WS_OVERLAPPEDWINDOW,  <span style="color:#75715e">// スタイル
</span></span></span><span style="display:flex;"><span>                      CW_USEDEFAULT, CW_USEDEFAULT,  <span style="color:#75715e">// 位置
</span></span></span><span style="display:flex;"><span>                      CW_USEDEFAULT, CW_USEDEFAULT,  <span style="color:#75715e">// サイズ
</span></span></span><span style="display:flex;"><span>                      NULL,   <span style="color:#75715e">// 親ウィンドウのハンドル
</span></span></span><span style="display:flex;"><span>                      NULL,   <span style="color:#75715e">// メニューハンドル
</span></span></span><span style="display:flex;"><span>                      hInst,  <span style="color:#75715e">// インスタンスハンドル
</span></span></span><span style="display:flex;"><span>                      NULL    <span style="color:#75715e">// lpに渡す構造体のポインタ
</span></span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (hWnd <span style="color:#f92672">==</span> NULL) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> EXIT_FAILURE;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// ウィンドウを表示
</span></span></span><span style="display:flex;"><span>  ShowWindow(hWnd, iCmdShow);
</span></span><span style="display:flex;"><span>  UpdateWindow(hWnd);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// メッセージループ
</span></span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">while</span> (TRUE) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> GetMessage(<span style="color:#f92672">&amp;</span>msg, NULL, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">||</span> i <span style="color:#f92672">==</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    TranslateMessage(<span style="color:#f92672">&amp;</span>msg);
</span></span><span style="display:flex;"><span>    DispatchMessage(<span style="color:#f92672">&amp;</span>msg);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> EXIT_SUCCESS;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ウィンドウプロシージャ
</span></span></span><span style="display:flex;"><span>LRESULT CALLBACK <span style="color:#a6e22e">WindowProc</span>(HWND hWnd, UINT msg, WPARAM wp, LPARAM lp) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">switch</span> (msg) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> WM_DESTROY:
</span></span><span style="display:flex;"><span>      PostQuitMessage(<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">default</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> DefWindowProc(hWnd, msg, wp, lp);
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div></div>
</figure>
<p>コマンドgccを入力してwindow.cをコンパイルします。</p>


<figure class="xCodeBlock">

<div class="xCodeBlock_code"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-text" data-lang="text"><span style="display:flex;"><span># gcc window.c -o window.exe -fexec-charset=CP932
</span></span><span style="display:flex;"><span># ./window.exe</span></span></code></pre></div></div>
</figure>
<p>ウィンドウが表示されたら成功です。かなり長いコードですがこれが雛形です。処理の流れを簡単に説明します。</p>
<ol>
<li>ウィンドウクラスを元にウィンドウを作成します。<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup></li>
<li>メッセージループを開始します。</li>
<li>イベントが発生するとシステムがメッセージを発行します。</li>
<li>メッセージループがメッセージを受け取りウィンドウプロシージャに送信します。</li>
<li>ウィンドウプロシージャがメッセージを受け取りイベントを処理します。<sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup></li>
<li>アプリケーションが終了するまで3～5を繰り返します。</li>
</ol>
<p>イベントの処理を記述することがWindowsプログラミングの主な作業になります。このようなプログラムを<a href="%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E9%A7%86%E5%8B%95%E5%9E%8B">イベントドリブン</a>といいます。ウィンドウプロシージャはシステムから自動的に呼び出されるという意味でコールバック関数とも呼ばれます。</p>
<h3 id="メインウィンドウの表示その2">メインウィンドウの表示(その2)</h3>
<p>メニューのついたウィンドウを表示してみます。以下のコードを記述したソースファイルwindow.cを作成します。</p>


<figure class="xCodeBlock">
<figcaption class="xCodeBlock_title">window.c</figcaption>
<div class="xCodeBlock_code"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;windows.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 記号定数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define WINDOW_CLASS &#34;foo&#34;                 </span><span style="color:#75715e">// ウィンドウクラス名
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define WINDOW_TITLE &#34;サンプルウィンドウ&#34;  </span><span style="color:#75715e">// タイトルバーの文字列
</span></span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// プロトタイプ宣言
</span></span></span><span style="display:flex;"><span>LRESULT CALLBACK <span style="color:#a6e22e">WindowProc</span>(HWND hWnd, UINT msg, WPARAM wp, LPARAM lp);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// エントリポイント
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> WINAPI <span style="color:#a6e22e">WinMain</span>(HINSTANCE hInst, HINSTANCE hPrevInst, LPSTR lpCmdLine,
</span></span><span style="display:flex;"><span>                   <span style="color:#66d9ef">int</span> iCmdShow) {
</span></span><span style="display:flex;"><span>  WNDCLASSEX wc;  <span style="color:#75715e">// ウィンドウクラス構造体
</span></span></span><span style="display:flex;"><span>  HWND hWnd;      <span style="color:#75715e">// ウィンドウハンドル
</span></span></span><span style="display:flex;"><span>  MSG msg;        <span style="color:#75715e">// メッセージ構造体
</span></span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// ウィンドウクラスを設定
</span></span></span><span style="display:flex;"><span>  wc.cbSize <span style="color:#f92672">=</span> <span style="color:#66d9ef">sizeof</span>(wc);              <span style="color:#75715e">// 構造体のサイズ
</span></span></span><span style="display:flex;"><span>  wc.style <span style="color:#f92672">=</span> CS_HREDRAW <span style="color:#f92672">|</span> CS_VREDRAW;  <span style="color:#75715e">// スタイル
</span></span></span><span style="display:flex;"><span>  wc.lpfnWndProc <span style="color:#f92672">=</span> WindowProc;         <span style="color:#75715e">// ウィンドウプロシージャ
</span></span></span><span style="display:flex;"><span>  wc.cbClsExtra <span style="color:#f92672">=</span> wc.cbWndExtra <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;   <span style="color:#75715e">// 拡張領域のサイズ
</span></span></span><span style="display:flex;"><span>  wc.hInstance <span style="color:#f92672">=</span> hInst;                <span style="color:#75715e">// インスタンスハンドル
</span></span></span><span style="display:flex;"><span>  wc.hIcon <span style="color:#f92672">=</span> LoadIcon(NULL, IDI_APPLICATION);  <span style="color:#75715e">// アイコン
</span></span></span><span style="display:flex;"><span>  wc.hIconSm <span style="color:#f92672">=</span> wc.hIcon;                       <span style="color:#75715e">// アイコン(小)
</span></span></span><span style="display:flex;"><span>  wc.hCursor <span style="color:#f92672">=</span> LoadCursor(NULL, IDC_ARROW);    <span style="color:#75715e">// カーソル
</span></span></span><span style="display:flex;"><span>  wc.hbrBackground <span style="color:#f92672">=</span> (HBRUSH)(COLOR_WINDOW);   <span style="color:#75715e">// 背景色
</span></span></span><span style="display:flex;"><span>  wc.lpszMenuName <span style="color:#f92672">=</span> NULL;                      <span style="color:#75715e">// メニュー名
</span></span></span><span style="display:flex;"><span>  wc.lpszClassName <span style="color:#f92672">=</span> WINDOW_CLASS;             <span style="color:#75715e">// ウィンドウクラス名
</span></span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// ウィンドウクラスを登録
</span></span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (RegisterClassEx(<span style="color:#f92672">&amp;</span>wc) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> EXIT_FAILURE;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// ウィンドウを作成
</span></span></span><span style="display:flex;"><span>  hWnd <span style="color:#f92672">=</span> CreateWindow(WINDOW_CLASS,         <span style="color:#75715e">// ウィンドウクラス名
</span></span></span><span style="display:flex;"><span>                      WINDOW_TITLE,         <span style="color:#75715e">// タイトルバーの文字列
</span></span></span><span style="display:flex;"><span>                      WS_OVERLAPPEDWINDOW,  <span style="color:#75715e">// スタイル
</span></span></span><span style="display:flex;"><span>                      CW_USEDEFAULT, CW_USEDEFAULT,  <span style="color:#75715e">// 位置
</span></span></span><span style="display:flex;"><span>                      CW_USEDEFAULT, CW_USEDEFAULT,  <span style="color:#75715e">// サイズ
</span></span></span><span style="display:flex;"><span>                      NULL,   <span style="color:#75715e">// 親ウィンドウのハンドル
</span></span></span><span style="display:flex;"><span>                      NULL,   <span style="color:#75715e">// メニューハンドル
</span></span></span><span style="display:flex;"><span>                      hInst,  <span style="color:#75715e">// インスタンスハンドル
</span></span></span><span style="display:flex;"><span>                      NULL    <span style="color:#75715e">// lpに渡す構造体のポインタ
</span></span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (hWnd <span style="color:#f92672">==</span> NULL) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> EXIT_FAILURE;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// ウィンドウを表示
</span></span></span><span style="display:flex;"><span>  ShowWindow(hWnd, iCmdShow);
</span></span><span style="display:flex;"><span>  UpdateWindow(hWnd);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// メッセージループ
</span></span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">while</span> (TRUE) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> GetMessage(<span style="color:#f92672">&amp;</span>msg, NULL, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">||</span> i <span style="color:#f92672">==</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    TranslateMessage(<span style="color:#f92672">&amp;</span>msg);
</span></span><span style="display:flex;"><span>    DispatchMessage(<span style="color:#f92672">&amp;</span>msg);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> EXIT_SUCCESS;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ウィンドウプロシージャ
</span></span></span><span style="display:flex;"><span>LRESULT CALLBACK <span style="color:#a6e22e">WindowProc</span>(HWND hWnd, UINT msg, WPARAM wp, LPARAM lp) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">static</span> HMENU hMenu;  <span style="color:#75715e">// メニューハンドル
</span></span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">switch</span> (msg) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> WM_CREATE:
</span></span><span style="display:flex;"><span>      hMenu <span style="color:#f92672">=</span> LoadMenu(NULL, <span style="color:#e6db74">&#34;IDR_MENU&#34;</span>);
</span></span><span style="display:flex;"><span>      SetMenu(hWnd, hMenu);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> WM_COMMAND:
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">switch</span> (LOWORD(wp)) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">40001</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>          DestroyWindow(hWnd);
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">40002</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>          MessageBox(NULL, <span style="color:#e6db74">&#34;Version 1.00&#34;</span>, <span style="color:#e6db74">&#34;バージョン情報&#34;</span>, MB_OK);
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> WM_CLOSE:
</span></span><span style="display:flex;"><span>      SetMenu(hWnd, NULL);
</span></span><span style="display:flex;"><span>      DestroyMenu(hMenu);
</span></span><span style="display:flex;"><span>      hMenu <span style="color:#f92672">=</span> NULL;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> WM_DESTROY:
</span></span><span style="display:flex;"><span>      PostQuitMessage(<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">default</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> DefWindowProc(hWnd, msg, wp, lp);
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div></div>
</figure>
<p>以下のコードを記述したリソースファイルresource.rcを作成します。メニューやダイアログなどのリソースデータはリソースファイルに記述します。</p>


<figure class="xCodeBlock">
<figcaption class="xCodeBlock_title">resource.rc</figcaption>
<div class="xCodeBlock_code"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>IDR_MENU MENU {
</span></span><span style="display:flex;"><span>  POPUP &#34;ファイル(&amp;F)&#34; {
</span></span><span style="display:flex;"><span>    MENUITEM &#34;終了(&amp;X)&#34;, 40001
</span></span><span style="display:flex;"><span>    MENUITEM &#34;バージョン情報(&amp;A)&#34;, 40002
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div></div>
</figure>
<p>今まではソースファイルから直接実行ファイルを作成していましたが今回はリソースファイルが追加されたので次のようにします。リソースファイルのコンパイルにはリソースコンパイラwindresを使用します。</p>
<ol>
<li>コマンドgccを入力してwindow.cをコンパイルしwindow.oを生成</li>
<li>コマンドwindresを入力してresource.rcをコンパイルしresource.oを生成</li>
<li>コマンドgccを入力してwindow.oとresource.oをリンクしwindow.exeを生成</li>
</ol>
<figure class="center"><img src="programming01.png">
</figure>

<p>ソースファイルが複数ある場合はオブジェクトファイル(*.o)という中間ファイルを介して実行ファイルを作成します。-cオプションを指定するとオブジェクトファイルが生成されます。コマンドgccには他にもさまざまなオプションを指定できます。詳細については<a href="http://x68000.q-e-d.net/~68user/unix/pickup?gcc">gccコマンドの使い方: UNIXの部屋</a>を参照してください。</p>


<figure class="xCodeBlock">

<div class="xCodeBlock_code"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-text" data-lang="text"><span style="display:flex;"><span># gcc -c window.c -fexec-charset=cp932
</span></span><span style="display:flex;"><span># windres -c 65001 resource.rc resource.o
</span></span><span style="display:flex;"><span># gcc window.o resource.o -o window.exe
</span></span><span style="display:flex;"><span># ./window.exe</span></span></code></pre></div></div>
</figure>
<p>メニューつきのウィンドウが表示されたら成功です。</p>
<h3 id="ソースファイルの分割">ソースファイルの分割</h3>
<p>ソースコードは処理内容に応じて複数のファイルに記述するのが一般的です。ソースファイルを分割する際に注意すべきことはグローバルな変数・関数のリンケージです。リンケージには内部リンケージと外部リンケージがあります。</p>
<p>グローバルな変数・関数に[static]という修飾子をつければ内部リンケージになり何もつけなければ外部リンケージになります。ただしC++ではグローバルな定数(const)に何もつけなければ内部リンケージになるので注意してください。</p>
<p>内部リンケージの変数・関数はそれらが定義されたファイルからしか参照することができません。</p>
<p>外部リンケージの変数・関数はどのファイルからも参照できます。外部リンケージの変数を参照するには参照元のファイルに[extern]という修飾子をつけて参照先の変数を宣言する必要があります。外部リンケージの関数を参照するには参照元のファイルに参照先の関数のプロトタイプ宣言が必要です。当然ですが外部リンケージの変数・関数の定義が複数のソースファイルで重複することは許されません。また内部リンケージと外部リンケージの識別子が重複することも許されません。リンケージの詳細については<a href="https://programming-place.net/ppp/contents/cpp2/main/separate_compile.html#linkage">分割コンパイル</a>を参照してください。</p>
<figure class="center"><img src="programming02.png">
</figure>

<h3 id="ビルド作業の自動化">ビルド作業の自動化</h3>
<p>上のようにコマンドを入力して実行ファイルを作成する作業をビルドといいます。コマンドmakeを使用すれば、更新されたファイルのみを対象にして効率よくビルドできます。以下のようなビルドの処理内容を記述したMakefileというファイルをソースファイルと同じ場所にあらかじめ作成しておきます。<sup id="fnref:5"><a href="#fn:5" class="footnote-ref" role="doc-noteref">5</a></sup></p>


<figure class="xCodeBlock">
<figcaption class="xCodeBlock_title">Makefile</figcaption>
<div class="xCodeBlock_code"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-make" data-lang="make"><span style="display:flex;"><span>TARGET <span style="color:#f92672">=</span> foo.exe <span style="color:#75715e"># 生成される実行ファイル</span>
</span></span><span style="display:flex;"><span>SOURCES <span style="color:#f92672">=</span> <span style="color:#66d9ef">$(</span>notdir <span style="color:#66d9ef">$(</span>shell find ./ -name <span style="color:#e6db74">&#39;*.c&#39;</span><span style="color:#66d9ef">))</span> <span style="color:#75715e"># コンパイルするソースファイル(*.c)</span>
</span></span><span style="display:flex;"><span>OBJECTS <span style="color:#f92672">=</span> <span style="color:#66d9ef">$(</span>SOURCES:.c<span style="color:#f92672">=</span>.o<span style="color:#66d9ef">)</span> resource.o <span style="color:#75715e"># リンクするオブジェクトファイル(*.o)</span>
</span></span><span style="display:flex;"><span>CC <span style="color:#f92672">=</span> gcc <span style="color:#75715e"># 使用するコンパイラ</span>
</span></span><span style="display:flex;"><span>CFLAGS <span style="color:#f92672">=</span> -g -O0 -Wall -fexec-charset<span style="color:#f92672">=</span>cp932 <span style="color:#75715e"># コンパイラのオプション(デバッグ用)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># CFLAGS = -s -O2 -Wall -fexec-charset=cp932 # コンパイラのオプション(リリース用)
</span></span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">.PHONY</span><span style="color:#f92672">:</span> all run clean
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">all</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">$(</span>TARGET<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># オブジェクトファイルから実行ファイルを作成
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">$(TARGET)</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">$(</span>OBJECTS<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">$(</span>CC<span style="color:#66d9ef">)</span> -o $@ $^
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ソースファイルからオブジェクトファイルを作成
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">%.o</span><span style="color:#f92672">:</span> %.c
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">$(</span>CC<span style="color:#66d9ef">)</span> <span style="color:#66d9ef">$(</span>CFLAGS<span style="color:#66d9ef">)</span> -c $&lt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># リソースファイルからオブジェクトファイルを作成
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">%.o</span><span style="color:#f92672">:</span> %.rc
</span></span><span style="display:flex;"><span>	windres -c <span style="color:#ae81ff">65001</span> -i $&lt; -o $@
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ビルドして実行ファイルを実行
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">run</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">$(</span>TARGET<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>	./<span style="color:#66d9ef">$(</span>TARGET<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># オブジェクトファイルおよび実行ファイルを削除
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">clean</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>	-@rm -f <span style="color:#66d9ef">$(</span>OBJECTS<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>	-@rm -f <span style="color:#66d9ef">$(</span>TARGET<span style="color:#66d9ef">)</span>
</span></span></code></pre></div></div>
</figure>
<p>ビルドを実行するにはMakefileと同じ場所から以下のようにします。</p>
<ul>
<li>make all(もしくはmake)と入力すれば実行ファイルfoo.exeが生成されます。</li>
<li>make runと入力すればビルドした後に実行ファイルが実行されます。</li>
<li>make cleanと入力すればオブジェクトファイルおよび実行ファイルが削除されます。</li>
</ul>
<p>詳細については<a href="http://x68000.q-e-d.net/~68user/unix/pickup?make">コマンド:make: UNIXの部屋</a>/<a href="http://objectclub.jp/community/memorial/homepage3.nifty.com/masarl/article/gnu-make/rule.html">自動化のためのGNU Make入門講座</a>/<a href="https://maku77.github.io/memo/tool/make.html">makeを使いこなすためのメモ</a>などを参照してください。</p>
<h3 id="メインウィンドウの表示その3">メインウィンドウの表示(その3)</h3>
<p>wxWidgetsを使用してウィンドウを表示してみます。</p>
<p>MSYS2でwxWidgetsをインストールします。</p>


<figure class="xCodeBlock">

<div class="xCodeBlock_code"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-text" data-lang="text"><span style="display:flex;"><span># pacman -S mingw-w64-i686-wxmsw3.1
</span></span><span style="display:flex;"><span># pacman -S mingw-w64-x86_64-wxmsw3.1</span></span></code></pre></div></div>
</figure>
<p>以下のコードを記述したソースファイルwindow.cppを作成します。</p>


<figure class="xCodeBlock">
<figcaption class="xCodeBlock_title">window.cpp</figcaption>
<div class="xCodeBlock_code"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;wx/wx.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// アプリケーションの単一クラス
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyApp</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> wxApp {
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">bool</span> OnInit();
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// メインウィンドウのフレームクラス
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyFrame</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> wxFrame {
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  MyFrame(<span style="color:#66d9ef">const</span> wxString<span style="color:#f92672">&amp;</span> title, <span style="color:#66d9ef">const</span> wxPoint<span style="color:#f92672">&amp;</span> pos, <span style="color:#66d9ef">const</span> wxSize<span style="color:#f92672">&amp;</span> size);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">private</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">void</span> OnExit(wxCommandEvent<span style="color:#f92672">&amp;</span> event);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">OnAbout</span>(wxCommandEvent<span style="color:#f92672">&amp;</span> event);
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// アプリケーションを初期化
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">bool</span> MyApp<span style="color:#f92672">::</span>OnInit() {
</span></span><span style="display:flex;"><span>  MyFrame<span style="color:#f92672">*</span> pFrame <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">new</span> MyFrame(_(<span style="color:#e6db74">&#34;サンプルウィンドウ&#34;</span>), wxDefaultPosition, wxSize(<span style="color:#ae81ff">640</span>, <span style="color:#ae81ff">480</span>));
</span></span><span style="display:flex;"><span>  pFrame<span style="color:#f92672">-&gt;</span>Show(true);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">this</span><span style="color:#f92672">-&gt;</span>SetTopWindow(pFrame);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> true;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// メインウィンドウを初期化
</span></span></span><span style="display:flex;"><span>MyFrame<span style="color:#f92672">::</span>MyFrame(<span style="color:#66d9ef">const</span> wxString<span style="color:#f92672">&amp;</span> title, <span style="color:#66d9ef">const</span> wxPoint<span style="color:#f92672">&amp;</span> pos, <span style="color:#66d9ef">const</span> wxSize<span style="color:#f92672">&amp;</span> size)
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">:</span> wxFrame(NULL, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, title, pos, size) {
</span></span><span style="display:flex;"><span>  wxMenu<span style="color:#f92672">*</span> pMenu <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> wxMenu;
</span></span><span style="display:flex;"><span>  pMenu<span style="color:#f92672">-&gt;</span>Append(wxID_ABOUT, _(<span style="color:#e6db74">&#34;バージョン情報(&amp;A)&#34;</span>));
</span></span><span style="display:flex;"><span>  pMenu<span style="color:#f92672">-&gt;</span>Append(wxID_EXIT, _(<span style="color:#e6db74">&#34;終了(&amp;X)&#34;</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  wxMenuBar<span style="color:#f92672">*</span> pMenuBar <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> wxMenuBar;
</span></span><span style="display:flex;"><span>  pMenuBar<span style="color:#f92672">-&gt;</span>Append(pMenu, _(<span style="color:#e6db74">&#34;ファイル(&amp;F)&#34;</span>));
</span></span><span style="display:flex;"><span>  SetMenuBar(pMenuBar);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">this</span><span style="color:#f92672">-&gt;</span>CreateStatusBar();
</span></span><span style="display:flex;"><span>  Center();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// イベントとハンドラを結合
</span></span></span><span style="display:flex;"><span>  Bind(wxEVT_MENU, <span style="color:#f92672">&amp;</span>MyFrame<span style="color:#f92672">::</span>OnAbout, <span style="color:#66d9ef">this</span>, wxID_ABOUT);
</span></span><span style="display:flex;"><span>  Bind(wxEVT_MENU, <span style="color:#f92672">&amp;</span>MyFrame<span style="color:#f92672">::</span>OnExit, <span style="color:#66d9ef">this</span>, wxID_EXIT);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// OnExitハンドラ
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> MyFrame<span style="color:#f92672">::</span>OnExit(wxCommandEvent<span style="color:#f92672">&amp;</span> WXUNUSED(event)) { Close(true); }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// OnAboutハンドラ
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> MyFrame<span style="color:#f92672">::</span>OnAbout(wxCommandEvent<span style="color:#f92672">&amp;</span> WXUNUSED(event)) {
</span></span><span style="display:flex;"><span>  wxMessageBox(_(<span style="color:#e6db74">&#34;Version 1.00&#34;</span>), _(<span style="color:#e6db74">&#34;バージョン情報&#34;</span>),
</span></span><span style="display:flex;"><span>               wxOK <span style="color:#f92672">|</span> wxICON_INFORMATION, <span style="color:#66d9ef">this</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>IMPLEMENT_APP(MyApp)</span></span></code></pre></div></div>
</figure>
<p>コマンドg++を入力してwindow.cppをコンパイルします。</p>


<figure class="xCodeBlock">

<div class="xCodeBlock_code"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-text" data-lang="text"><span style="display:flex;"><span># g++ window.cpp -o window -fexec-charset=cp932 `wx-config-3.1 --cxxflags --libs`
</span></span><span style="display:flex;"><span># ./window.exe</span></span></code></pre></div></div>
</figure>
<p>ウィンドウが表示されたら成功です。WindowsAPIを使用した場合と比較してソースコードがかなり短くなりました。</p>
<p>wxWidgetsはC++で使用できるGUIツールキット(C++のクラスライブラリ)です。wxWidgetsには便利で高機能なクラスがたくさん用意されています。<a href="https://github.com/wxFormBuilder/wxFormBuilder">wxFormBuilder</a>などのGUIビルダと併用すれば効率的にGUIのアプリケーションを作成できます。詳細については<a href="https://murank.github.io/wxwidgetsjp/">wxWidgets 日本語ドキュメントプロジェクト</a>を参照してください。</p>
<h2 id="プログラミングの学習方法">プログラミングの学習方法</h2>
<p>MSYS2はプログラミングの学習に最適な環境です。MSYS2でサンプルコードを繰り返し実行する方法を紹介します。簡単にプログラムを実行できるようにするため以下のようなシェルスクリプトを作成します。</p>


<figure class="xCodeBlock">

<div class="xCodeBlock_code"><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#! /usr/bin/bash
</span></span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>clear;
</span></span><span style="display:flex;"><span>cd /tmp;
</span></span><span style="display:flex;"><span>echo -e <span style="color:#e6db74">&#34;\nコードを入力してください:\n&#34;</span>;
</span></span><span style="display:flex;"><span>cat &gt;foo.c;
</span></span><span style="display:flex;"><span>clear;
</span></span><span style="display:flex;"><span>gcc -o foo foo.c;
</span></span><span style="display:flex;"><span>echo -e <span style="color:#e6db74">&#34;\n実行結果:\n&#34;</span>;
</span></span><span style="display:flex;"><span>./foo.exe;</span></span></code></pre></div></div>
</figure>
<p>このシェルスクリプトを実行してサンプルコードを貼り付けCtrl-dを入力すると実行結果が表示されます。サンプルコードのソースファイル(foo.c)および実行ファイル(foo.exe)は/tmpに作成されます。</p>
<p>プログラミングは習うより慣れろです。見よう見まねでやっていけば自然に身につきます。覚えることはたくさんありますが単純なことを1つ1つ積み重ねていくだけです。そして理屈よりも実際にプログラムを動かしてプログラミングに親しむことが大切です。</p>
<p>最後にC/C++およびWindowsAPIについて解説しているウェブサイトを紹介しておきます。</p>
<table>
  <thead>
      <tr>
          <th></th>
          <th></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><a href="http://wisdom.sakura.ne.jp/">WisdomSoft</a></td>
          <td>C/C++およびWindowsAPIについての解説があります。ポイントを押さえた説明のあとに単純なプログラムで実際の動作を示しています。プログラミングがはじめての人でも途中でつまづくことはないでしょう。</td>
      </tr>
      <tr>
          <td><a href="https://programming-place.net/ppp/index.html">ProgrammingPlacePlus</a></td>
          <td>C/C++の構文や仕様についての詳細を分かりやすく説明しています。各章の終わりには演習問題が用意されています。C/C++のリファレンスとしても重宝します。</td>
      </tr>
      <tr>
          <td><a href="http://www.kab-studio.biz/">KAB-studio</a></td>
          <td>VC(Microsoftの統合開発環境)とMFC(VCに付属するクラスライブラリ)によるWindowsプログラミングについて解説しています。内容は少し古いですがC++についての解説は参考になります。</td>
      </tr>
      <tr>
          <td><a href="http://www7b.biglobe.ne.jp/~robe/cpphtml/index.html">ロベールのＣ＋＋教室</a></td>
          <td>C++についてC言語を知らない人にもわかるように基礎から解説しています。各章の要点が最初と最後に掲げられ解説も短くまとまっているので読み進めやすいですが、取り上げる内容が広範囲におよぶため、ある程度コンピュータやプログラミングについての知識がないと消化不良を起こすかもしれません。中級者以上の人がC++およびプログラミングについての知識を整理するのには役に立つでしょう。</td>
      </tr>
      <tr>
          <td><a href="http://www.kumei.ne.jp/c_lang/">猫でもわかるプログラミング</a></td>
          <td>C/C++およびWindowsAPIについて解説しています。猫でもわかると銘打たれていますがそれに反して内容はかなり実践的です。章を追うごとにサンプルプログラムが長くなるのでプログラミングの経験がないと挫折するかもしれません。</td>
      </tr>
  </tbody>
</table>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>独自の変数型や構造体がたくさん出てきますが難しく考える必要はありません。&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>MSYS2 MinGW 64-bitの環境で作成したプログラムは32bitの環境では動作しないので注意してください。&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p>ウィンドウクラスはC++のクラスとは関係ありません。混同しないように注意してください。&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4">
<p>イベントについての情報はパラメータとしてウィンドウプロシージャに渡されます。&#160;<a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:5">
<p>コマンドを記述する行はタブでインデントしてください。スペースでインデントするとエラーになります。&#160;<a href="#fnref:5" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>


    </div><footer>
<div>Powered by <a href="https://gohugo.io/">Hugo</a></div>
<div><a target="_blank" href="https://www.amazon.co.jp/b?_encoding=UTF8&tag=foo23-22&linkCode=ur2&linkId=5c65ecd6930af79eab6fbe1abe8e5cb1&camp=247&creative=1211&node=2127209051">Amazonのパソコン・周辺機器</a></div>
</footer>
</body>
</html>
